# Данные и индексы

## Описание

В одной фруктовой компании стали случаться сбои и часто происходило падение сервиса. При разборе инцидентов выяснилось, что в какой-то момент СУБД загружается на 100% и увеличивается время ответа. 

Проблема оказалась в долгом поиске пользователей.

Помогите настроить индексы.

## Структура задания

В файле `docker-compose.yml` собраны контейнеры:

- store - база данных;
- service - сервис поиска данных;
- adminer - web-интерфейс подключения к БД;

Вам нужно запустить сервис, загрузить дамп базы данных https://disk.yandex.ru/d/cu-cAeRPwj8z6g и проверить работу с помощью вызова ручек поиска.

Индексы нужно исправлять в контейнере store и дублировать в файле solution/indexes.sql`.

## Примеры запросов к сервису

1. Проверьте работу сервиса, посмотрите логи контейнеров и постройте план запроса. Определите, какие нужны индексы.

`curl localhost/v1/users/?search=запрос`

2. Поиск по расширенному набору полей и сортировкой:

`curl localhost/v2/users/?search=запрос`

3. Поиск с учетом связанных таблиц:

`curl localhost/v3/users/?search=запрос`

## Запуск проекта

1. Собираете образ сервиса

`make build`

2. Запускаете контейнеры

`make up`

3. Загружаете бекап https://disk.yandex.ru/d/cu-cAeRPwj8z6g

4. `make restore_db` - загрузить дамп для тестирования;

Если будут ошибки - проверьте, что образ собран и база данных загружена.

Возможны падения из-за долгой работы БД. Ошибки смотрите в логах.

## Дополнительные команды

- `make build` - сборка окружения;
- `make up`- запуск сервиса;
- `make test` - тестирование работы сервиса;

